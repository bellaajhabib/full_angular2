!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.tsPromise=t()}}(function(){return function t(e,i,r){function n(s,u){if(!i[s]){if(!e[s]){var f="function"==typeof require&&require;if(!u&&f)return f(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){var i=e[s][1][t];return n(i?i:t)},h,h.exports,t,e,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e,i){"use strict";var r=this&&this.a||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},n="function"==typeof Error.captureStackTrace,o=function(t){function e(e,i){t.call(this,i),this.name=e,this.message=i,n?Error.captureStackTrace(this,this.constructor):this.stack="dummy\n<no trace>"}return r(e,t),e}(Error);Object.defineProperty(i,"__esModule",{value:!0}),i.default=o},{}],2:[function(t,e,i){"use strict";function r(t,e){}function n(){}function o(t){return t}var s=this&&this.a||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},u=t("./async"),f=t("./util"),c=t("./Trace"),h=t("./BaseError"),a=function(t){function e(e,i){t.call(this,"UnhandledRejectionError","unhandled rejection: "+e),this.reason=e,this.trace=i;var r=this.reason&&"object"==typeof this.reason&&this.reason.stack;"string"!=typeof r&&(r=String(e)),this.stack="UnhandledRejectionError: "+r}return s(e,t),e}(h.default);i.UnhandledRejectionError=a;var l,p=void 0,d=!1;!function(t){t[t.Pending=0]="Pending",t[t.Fulfilled=1]="Fulfilled",t[t.Rejected=2]="Rejected"}(l||(l={})),r(void 0,void 0);var v={error:void 0},y=new c.default,w=void 0,m=0,Promise=function(){function Promise(t){var e=this;if(this.b=m++,this.c=0,this.d=void 0,this.e=void 0,this.f=void 0,p&&p(this,"construct"),d&&(this.f=new c.default(Promise),w&&this.g(w)),t!==r){if("function"!=typeof t)throw new TypeError("Promise resolver is not a function");var i=!1;try{t(function(t){i||(i=!0,e.h(t))},function(t){i||(i=!0,e.i(o(t)))})}catch(t){i||(i=!0,this.i(o(t)))}}}return Promise.prototype.then=function(t,e){if(p&&p(this,"then("+typeof t+", "+typeof e+")"),1===this.c&&"function"!=typeof t||2===this.c&&"function"!=typeof e)return this;var i=new(Object.getPrototypeOf(this).constructor)(r);return i.g(this),this.j(t,e,i,void 0),i},Promise.prototype.done=function(t,e){if(p&&p(this,"done("+typeof t+", "+typeof e+")"),1!==this.c||"function"==typeof t){var i=y;d&&(i=new c.default,this.f&&i.setSource(this.f)),this.j(t,e,void 0,i)}},Promise.prototype.catch=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(1===arguments.length){var i=arguments[0];return this.then(void 0,i)}var r=arguments[0],n=arguments[1];return this.then(void 0,function(t){var e=!1;if("function"==typeof r)e=r.prototype instanceof Error||r===Error?t instanceof r:r(t);else{if(!Array.isArray(r))throw new TypeError("invalid predicate to .catch(), got "+typeof r);for(var i=0;i<r.length;i++)if(t instanceof r[i]){e=!0;break}}return e?n(t):Promise.reject(t)})},Promise.prototype.finally=function(t){var e=this,i=function(){return t(e)};return this.then(i,i).return(this)},Promise.prototype.isFulfilled=function(){return 1===this.c},Promise.prototype.isRejected=function(){return 2===this.c},Promise.prototype.isPending=function(){return 0===this.c},Promise.prototype.value=function(){if(!this.isFulfilled())throw new Error("Promise is not fulfilled");return this.d},Promise.prototype.reason=function(){if(!this.isRejected())throw new Error("Promise is not rejected");return this.d},Promise.prototype.inspect=function(){return this.toString()},Promise.prototype.toString=function(){var t;switch(this.c){case 0:t="pending";break;case 1:t="fulfilled";break;case 2:t="rejected";break;default:t="unknown"}return"[Promise "+this.b+": "+t+"]"},Promise.prototype.delay=function(t){return this.then(function(e){return new Promise(function(i){setTimeout(function(){return i(e)},t)})})},Promise.prototype.return=function(t){return void 0===t?this.then(n):this.then(function(){return t})},Promise.prototype.throw=function(t){return this.then(function(){return Promise.reject(t)})},Promise.resolve=function(t){var e=new Promise(r);return e.h(t),e},Promise.reject=function(t){var e=new Promise(r);return e.i(t),e},Promise.all=function(t){return new Promise(function(e,i){function r(t,r){var s=t instanceof Promise?t:Promise.resolve(t);s.done(function(t){n[r]=t,o--,0===o&&e(n)},function(t){return i(t)})}if(f.assert(Array.isArray(t),"thenables must be an Array"),0===t.length)return void e([]);for(var n=new Array(t.length),o=t.length,s=0;s<t.length;s++)r(t[s],s)})},Promise.race=function(t){return new Promise(function(e,i){f.assert(Array.isArray(t),"thenables must be an Array");for(var r=0;r<t.length;r++){var n=t[r],o=n instanceof Promise?n:Promise.resolve(n);Promise.resolve(o).done(e,i)}})},Promise.defer=function(){var t,e,i=new Promise(function(i,r){t=i,e=r});return{promise:i,reject:e,resolve:t}},Promise.delay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];if(void 0===arguments[1]){var i=arguments[0];return new Promise(function(t){setTimeout(t,i)})}return Promise.resolve(arguments[0]).delay(arguments[1])},Promise.setLongTraces=function(t){d=t},Promise.setTracer=function(t){p="function"==typeof t?t:void 0},Promise.flush=function(){u.default.flush()},Promise.prototype.g=function(t){this.f&&t.f&&this.f.setSource(t.f)},Promise.prototype.h=function(t){if(f.assert(0===this.c),!t)return void this.k(t);if(this===t)return void this.i(new TypeError("cannot resolve Promise to self"));if(t instanceof Promise)return t.g(this),void(0===t.c?this.l(t):1===t.c?this.k(t.d):this.i(t.d));if("object"==typeof t||"function"==typeof t){var e=this.m(t);if(e===v)return void this.i(o(v.error));if("function"==typeof e)return void this.n(t,e)}this.k(t)},Promise.prototype.m=function(t){try{var e=t.then;return e}catch(t){return v.error=t,v}},Promise.prototype.k=function(t){f.assert(0===this.c),p&&p(this,"_fulfill("+typeof t+")"),this.c=1,this.d=t,this.o()},Promise.prototype.i=function(t){var e=this;if(f.assert(0===this.c),p&&p(this,"_reject("+t+")"),this.c=2,this.d=t,this.f&&this.d instanceof Error&&!this.d.trace){this.d.trace=this.f;var i=this.d.stack;i&&Object.defineProperty(this.d,"stack",{enumerable:!1,get:function(){return i+"\n  from Promise at:\n"+e.f.inspect()}})}this.o()},Promise.prototype.l=function(t){f.assert(0===this.c),p&&p(this,"_follow([Promise "+t.b+"])"),t.j(void 0,void 0,this,void 0)},Promise.prototype.n=function(t,e){var i=this;f.assert(0===this.c),p&&p(this,"_follow([Thenable])");var r=!1;try{e.call(t,function(t){r||(r=!0,i.h(t))},function(t){r||(r=!0,i.i(o(t)))})}catch(t){r||(r=!0,this.i(o(t)))}},Promise.prototype.j=function(t,e,i,r){var n={promise:this,onFulfilled:t,onRejected:e,slave:i,done:r};if(0!==this.c)u.default.enqueue(Promise.p,n);else if(this.e){var o=this.e.length;this.e[o]=n}else this.e=[n]},Promise.prototype.o=function(){if(this.e){var t=0,e=this.e,i=e.length;for(this.e=void 0;t<i;)u.default.enqueue(Promise.p,e[t++])}},Promise.prototype.q=function(t){var e=1===this.c?t.onFulfilled:t.onRejected;if(t.done){if(p&&p(this,"_unwrap()"),"function"!=typeof e){if(2===this.c){var i=new a(this.d,t.done);throw i}return}f.assert(!w),w=this;try{var r=e(this.d);if(r){var n=r instanceof Promise?r:Promise.resolve(r);n.done()}w=void 0}catch(e){w=void 0;var i=new a(e,t.done);throw i}}else{var s=t.slave;if(p&&p(this,"_unwrap("+s.b+")"),"function"==typeof e){f.assert(!w),w=s;try{s.h(e(this.d))}catch(t){s.i(o(t))}w=void 0}else 1===this.c?s.k(this.d):s.i(this.d)}},Promise.p=function(t){t.promise.q(t)},Promise}();i.Promise=Promise,Object.defineProperty(i,"__esModule",{value:!0}),i.default=Promise},{"./BaseError":1,"./Trace":4,"./async":5,"./util":8}],3:[function(t,e,i){"use strict";var r="function"==typeof Error.captureStackTrace,n=function(){function t(e){void 0===e&&(e=t),r?Error.captureStackTrace(this,e):this.stack="dummy\n<no trace>"}return t.prototype.inspect=function(){var t=this.stack.split("\n");return t.shift(),t.join("\n")},t}();Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{}],4:[function(t,e,i){"use strict";var r=t("./Stack"),n=function(){function t(e){void 0===e&&(e=t),this.stack=new r.default(e)}return t.prototype.setSource=function(e){e.sources?(this.sources=e.sources.concat(e.stack),this.sources.length>t.traceLimit&&(this.sources=this.sources.slice(0,t.traceLimit))):this.sources=[e.stack]},t.prototype.inspect=function(){var t=this.stack.inspect();if(this.sources)for(var e=this.sources.length-1;e>=0;e--)t+="\n  from previous:\n"+this.sources[e].inspect();return t},t.traceLimit=10,t}();Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{"./Stack":3}],5:[function(t,e,i){"use strict";var r=t("./util"),n=function(){function t(){this.length=0,this.r=1e3,this.s=0}return t.prototype.push=function(t,e){return this[this.length++]=t,this[this.length++]=e,this.length<this.r},t.prototype.flush=function(){for(;this.s<this.length;){var t=this[this.s],e=this[this.s+1];this[this.s]=this[this.s+1]=void 0,this.s+=2,t(e)}this.length=0,this.s=0},t}(),o=function(){function t(){var t=this;this.t=[],this.u=[new n],this.v=this.u[0],this.w=function(){return t.x()},this.y=!1,this.z=!1,this.A=void 0}return t.prototype.setScheduler=function(t){r.assert(void 0===t||null===t||"function"==typeof t),this.A=t},t.prototype.enqueue=function(t,e){this.y||this.z||this.B(),this.v||(this.v=this.t.pop(),this.v||(this.v=new n),this.u.push(this.v)),this.v.push(t,e)||(this.v=void 0)},t.prototype.flush=function(){r.assert(!this.y,"cannot recursively flush"),this.y=!0;try{for(;;){if(this.u[0].flush(),1===this.u.length){this.v=this.u[0];break}r.assert(this.v!==this.u[0]),this.t.push(this.u.shift())}}finally{this.y=!1,this.u[0].length>0&&!this.z&&this.B()}},t.prototype.B=function(){r.assert(!this.z);var t=this.A;t||(t="function"==typeof setImmediate?setImmediate:setTimeout),t(this.w),this.z=!0},t.prototype.x=function(){this.z=!1,this.flush()},t}();i.Async=o,i.async=new o,Object.defineProperty(i,"__esModule",{value:!0}),i.default=i.async},{"./util":8}],6:[function(t,e,i){"use strict";var r=t("./Promise");i.default=r.default,i.Promise=r.Promise,i.UnhandledRejectionError=r.UnhandledRejectionError;var n=t("./polyfill");i.polyfill=n.default;var o=t("./BaseError");i.BaseError=o.default},{"./BaseError":1,"./Promise":2,"./polyfill":7}],7:[function(t,e,i){"use strict";function r(t){void 0===t&&(t=!1);var e=o.getGlobal();return!!e&&(t||"function"!=typeof e.Promise?(e.Promise=n.Promise,!0):e.Promise instanceof n.Promise)}var n=t("./Promise"),o=t("./util");Object.defineProperty(i,"__esModule",{value:!0}),i.default=r},{"./Promise":2,"./util":8}],8:[function(t,e,i){"use strict";function r(t,e){if(!t)throw new Error(e?"assertion failed: "+e:"assertion failed")}function n(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;var t;try{t=new Function("return this")()}catch(t){}return t}i.assert=r,i.getGlobal=n},{}]},{},[6])(6)});
